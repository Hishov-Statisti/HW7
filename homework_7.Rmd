---
title: "Exercies 7 - Alon Goodman & Ran Hassid"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

# Q1 #

## a ##


```{r}
# ex6data1 <- read.csv("C:/Users/Alon/Desktop/Studies/Statistics/Statistical_Computing/Exercises/HW6/ex6data1.csv")

ex7q1 <- read.csv("~/Desktop/Ran/D year/semester b/hishov statisti/exercies/HW7/ex7q1.csv")

```

```{r,echo=FALSE}
#knitr::include_graphics("1.a.png")
```

```{r}
lambda_hat.a <-  sum((ex7q1$frequencies..ni.*ex7q1$number.of.cases..i.)/1500)
cat(sprintf("lambda (MLE) = %s", lambda_hat.a) )
```

```{r}
x <- ex7q1$frequencies..ni
y <- ex7q1$number.of.cases..i.

plot(y,x,type = "o",col = "red")
y_p <- rpois(n = 1500,lambda = lambda_hat.a)
table_y_p <- as.vector(table(y_p))
y_p_unique <- sort(unique((y_p)))
lines(y_p_unique,table_y_p, type = "l",col= "blue")
```

# b #

```{r,echo=FALSE}
#knitr::include_graphics("1.b.png")
```


# c #

```{r,echo=FALSE}
#knitr::include_graphics("1.c.png")
```


```{r}
alpha_k1_numerator <- function(alpha_k,beta_k,lambda1_k,lambda2_k){
  c1_k <- (alpha_k) / 
    ((alpha_k) + (beta_k *  exp(-lambda1_k)) + ((1-alpha_k-beta_k) * exp(-lambda2_k)))
  sum_c1_k <-  ex7q1[1,2] * c1_k 
  return(sum_c1_k)
}
```


```{r}
beta_k1_numerator <- function(alpha_k,beta_k,lambda1_k,lambda2_k){
  c2_k <- numeric(17)
  for (i in 1:17){
    c2_k[i] <- (beta_k * lambda1_k^ex7q1[i,1] * exp(-lambda1_k)) / 
                  ((alpha_k*as.numeric(ex7q1[i,1]==0)) + (beta_k * (lambda1_k^ex7q1[i,1]) * exp(-lambda1_k)) +                                                     ((1-alpha_k-beta_k) * (lambda2_k^ex7q1[i,1]) * exp(-lambda2_k)))
  }
  sum_c2_k <- sum(ex7q1[,2]*c2_k)
  return(sum_c2_k)
}
```


```{r}
lambda1_k1_denominator <- function(alpha_k,beta_k,lambda1_k,lambda2_k){
  c2_k <- numeric(17)
  for (i in 1:17){
    c2_k[i] <- (beta_k * lambda1_k^ex7q1[i,1] * exp(-lambda1_k)) / 
                  ((alpha_k*as.numeric(ex7q1[i,1]==0)) + (beta_k * (lambda1_k^ex7q1[i,1]) * exp(-lambda1_k)) +                                                     ((1-alpha_k-beta_k) * (lambda2_k^ex7q1[i,1]) * exp(-lambda2_k)))
  }
  sum_c2_k <- sum(ex7q1[,2]*c2_k)
  return(sum_c2_k)
}
```


```{r}
lambda2_k1_denominator <- function(alpha_k,beta_k,lambda1_k,lambda2_k){
  
  c3_k <- numeric(17)
  for (i in 1:17){
    c3_k[i] <- ((1-alpha_k-beta_k) * (lambda2_k^ex7q1[i,1]) * exp(-lambda2_k)) / 
                  ((alpha_k*as.numeric(ex7q1[i,1]==0)) + (beta_k * (lambda1_k^ex7q1[i,1]) * exp(-lambda1_k)) +                                                     ((1-alpha_k-beta_k) * (lambda2_k^ex7q1[i,1]) * exp(-lambda2_k)))
  }
  sum_c3_k <- sum(ex7q1[,2] * c3_k)
  return(sum_c3_k)
}
```


```{r}
lambda1_k1_numerator <- function(alpha_k,beta_k,lambda1_k,lambda2_k){
  c2_k <- numeric(17)
  for (i in 1:17){
    c2_k[i] <- (beta_k * (lambda1_k^ex7q1[i,1]) * exp(-lambda1_k)) / 
                  ((alpha_k*as.numeric(ex7q1[i,1]==0)) + (beta_k * (lambda1_k^ex7q1[i,1]) * exp(-lambda1_k)) +                                                     ((1-alpha_k-beta_k) * (lambda2_k^ex7q1[i,1]) * exp(-lambda2_k)))
  }
  c2_k_xj <- numeric(17)
  for (i in 1:17){
    c2_k_xj[i] <- (ex7q1[i,1] * c2_k[i])
  }
  sum_c2_k_xj <-  sum(ex7q1[,2]*c2_k_xj)
  return(sum_c2_k_xj)
}
```


```{r}
lambda2_k1_numerator <- function(alpha_k,beta_k,lambda1_k,lambda2_k){
  
  c3_k <- numeric(17)
  for (i in 1:17){
    c3_k[i] <-  ((1-alpha_k-beta_k) * (lambda2_k^ex7q1[i,1]) * exp(-lambda2_k)) / 
                  ((alpha_k*as.numeric(ex7q1[i,1]==0)) + (beta_k * (lambda1_k^ex7q1[i,1]) * exp(-lambda1_k)) +                                                     ((1-alpha_k-beta_k) * (lambda2_k^ex7q1[i,1]) * exp(-lambda2_k)))
  }
  c3_k_xj <- numeric(17)
  for (i in 1:17){
    c3_k_xj[i] <- ex7q1[i,1] * c3_k[i]
  }
  sum_c3_k_xj <-  sum(ex7q1[,2]*c3_k_xj)
  return(sum_c3_k_xj)
}
```

```{r}
EM_algorithm <- function(alpha_0,beta_0,lambda1_0,lambda2_0,epsilon){
  
  theta_k <- c(alpha_0,beta_0,lambda1_0,lambda2_0)
  
  alpha_k1 <- alpha_k1_numerator(alpha_0,beta_0,lambda1_0,lambda2_0) / 1500
  
  beta_k1 <- beta_k1_numerator(alpha_0,beta_0,lambda1_0,lambda2_0) / 1500
  
  lambda1_k1 <- lambda1_k1_numerator(alpha_0,beta_0,lambda1_0,lambda2_0) /
    lambda1_k1_denominator(alpha_0,beta_0,lambda1_0,lambda2_0)
  
  lambda2_k1 <- lambda2_k1_numerator(alpha_0,beta_0,lambda1_0,lambda2_0) /
    lambda2_k1_denominator(alpha_0,beta_0,lambda1_0,lambda2_0)
  
  theta_k1 <- c(alpha_k1,beta_k1,lambda1_k1,lambda2_k1)
  
  while(norm(theta_k1-theta_k,type = "2")>epsilon){
    
    tetha_k <- theta_k1
    
    alpha_k1 <- alpha_k1_numerator(tetha_k[1],tetha_k[2],tetha_k[3],tetha_k[4]) / 1500
    
    beta_k1 <- beta_k1_numerator(tetha_k[1],tetha_k[2],tetha_k[3],tetha_k[4]) / 1500

    lambda1_k1 <- lambda1_k1_numerator(tetha_k[1],tetha_k[2],tetha_k[3],tetha_k[4]) /
      lambda1_k1_denominator(tetha_k[1],tetha_k[2],tetha_k[3],tetha_k[4])
    
    lambda2_k1 <- lambda2_k1_numerator(tetha_k[1],tetha_k[2],tetha_k[3],tetha_k[4]) /
      lambda2_k1_denominator(tetha_k[1],tetha_k[2],tetha_k[3],tetha_k[4])
    
    theta_k1 <- c(alpha_k1,beta_k1,lambda1_k1,lambda2_k1)
  }
  
  return(cat(sprintf("alpha (EM) = %s", round(alpha_k1,5)),
             sprintf("beta (EM) = %s", round(beta_k1,5)),
             sprintf("lambda1 (EM) = %s", round(lambda1_k1,5)),
             sprintf("lambda2 (EM) = %s", round(lambda2_k1,5)),
             sep = "\n"))
}
```


```{r}

result <- EM_algorithm(alpha = 1/3, beta = 1/3,lambda1 = 6.736,lambda2 = 11.85,epsilon = 3)
```











